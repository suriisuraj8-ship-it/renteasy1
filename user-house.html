<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Available Shops | Chat Point</title>

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>

  <style>
    :root {
      --bg:#07070a; --card:#0f1724; --muted:#a8b3c2;
      --accent:#ff7b00; --green:#22c55e; --radius:14px;
    }
    body {
      margin:0; font-family:"Poppins",sans-serif;
      background:linear-gradient(180deg,#071226,var(--bg));
      color:#fff; min-height:100vh; display:flex; flex-direction:column;
    }
    header {
      display:flex; justify-content:space-between; align-items:center;
      padding:12px 16px; background:rgba(255,255,255,0.02);
      backdrop-filter:blur(6px); border-bottom:1px solid rgba(255,255,255,0.03);
      position:sticky; top:0; z-index:50;
    }
    .brand { font-weight:700; font-size:18px; }
    .brand .chat { color:var(--accent); }
    .brand .point { color:#fff; }

    /* Promo slider */
    .promo { padding:14px; display:flex; justify-content:center; }
    .promo-slider {
      width:95%; max-width:1100px; height:220px;
      border-radius:14px; overflow:hidden;
      background:#000; box-shadow:0 8px 30px rgba(2,6,23,0.6);
      position:relative; border:1px solid rgba(255,255,255,0.03);
    }
    .promo-slider img { width:100%; height:100%; object-fit:cover; display:none; }
    .promo-slider img.active { display:block; }
    .promo-slider .dots {
      position:absolute; bottom:8px; left:50%; transform:translateX(-50%);
      display:flex; gap:6px;
    }
    .promo-slider .dot {
      width:8px;height:8px;border-radius:50%;
      background:rgba(255,255,255,0.35); cursor:pointer;
    }
    .promo-slider .dot.active { background:var(--accent); }

    main { padding:14px; flex:1; }
    .grid {
      display:grid;
      grid-template-columns: repeat(auto-fill,minmax(300px,1fr));
      gap:18px;
    }
    .card {
      background: rgba(255,255,255,0.02);
      border-radius:var(--radius);
      overflow:hidden;
      box-shadow:0 8px 20px rgba(2,6,23,0.6);
      cursor:pointer;
      transition:transform .2s ease;
    }
    .card:hover { transform:translateY(-5px); }
    .card img { width:100%; height:180px; object-fit:cover; }
    .info { padding:10px 12px; }
    .shop-name { font-weight:700; color:var(--accent); font-size:16px; }
    .desc { font-size:13px; color:var(--muted); margin-top:4px; }
    footer { text-align:center; padding:12px; color:#999; font-size:13px; }
    .placeholder { text-align:center; color:var(--muted); padding:40px; }
  </style>
</head>
<body>

  <header>
    <div class="brand"><span class="chat">Chat</span><span class="point">Point</span></div>
  </header>

  <!-- Promo slider -->
  <div class="promo">
    <div class="promo-slider" id="promoSlider">
      <img src="https://images.unsplash.com/photo-1600891964599-f61ba0e24092?q=80&w=1600&auto=format&fit=crop" class="active" alt="promo1" />
      <img src="https://images.unsplash.com/photo-1544025162-d76694265947?q=80&w=1600&auto=format&fit=crop" alt="promo2" />
      <img src="https://images.unsplash.com/photo-1546069901-eacef0df6022?q=80&w=1600&auto=format&fit=crop" alt="promo3" />
      <div class="dots" id="promoDots"></div>
    </div>
  </div>

  <main>
    <div id="grid" class="grid">
      <div class="placeholder">Loading shops...</div>
    </div>
  </main>

  <footer>Â© 2025 Chat Point</footer>

  <script>
    // Auto-detect backend URL (works for localhost + live)
    const BASE_URL =
      window.location.hostname === "localhost"
        ? "http://localhost:5000"
        : "https://renteasy1.onrender.com";
    const API_URL = `${BASE_URL}/api/properties/shop`;

    // Promo slider
    (function promoInit(){
      const slider = document.getElementById("promoSlider");
      const imgs = Array.from(slider.querySelectorAll("img"));
      const dotsWrap = document.getElementById("promoDots");
      imgs.forEach((_,i)=>{
        const d=document.createElement("div");
        d.className="dot"; if(i===0) d.classList.add("active");
        d.onclick=()=>{ imgs.forEach(im=>im.classList.remove("active")); imgs[i].classList.add("active");
          dotsWrap.querySelectorAll(".dot").forEach(dd=>dd.classList.remove("active")); d.classList.add("active"); };
        dotsWrap.appendChild(d);
      });
      let idx=0;
      setInterval(()=>{ idx=(idx+1)%imgs.length;
        imgs.forEach(im=>im.classList.remove("active")); imgs[idx].classList.add("active");
        const dots=dotsWrap.querySelectorAll(".dot");
        dots.forEach(dd=>dd.classList.remove("active")); dots[idx].classList.add("active");
      },5000);
    })();

    async function loadShops() {
      const grid = document.getElementById("grid");
      grid.innerHTML = `<div class="placeholder">Fetching shops...</div>`;
      try {
        const res = await fetch(API_URL);
        const data = await res.json();
        if (!data.success || !data.properties?.length) {
          grid.innerHTML = `<div class="placeholder">No shops available.</div>`;
          return;
        }
        renderShops(data.properties);
      } catch (err) {
        console.error(err);
        grid.innerHTML = `<div class="placeholder">Failed to load shops.</div>`;
      }
    }

    function renderShops(shops) {
      const grid = document.getElementById("grid");
      grid.innerHTML = "";
      shops.forEach(shop => {
        const card = document.createElement("div");
        card.className = "card";
        const image = Array.isArray(shop.imageUrl) ? shop.imageUrl[0] : shop.imageUrl;
        card.innerHTML = `
          <img src="${image || "https://via.placeholder.com/400x180"}" alt="${shop.shopName}">
          <div class="info">
            <div class="shop-name">${shop.shopName || "Unnamed Shop"}</div>
            <div class="desc">${shop.description || "No description available."}</div>
          </div>
        `;
        card.onclick = () => {
          window.location.href = \`items.html?shopId=\${shop._id}\`;
        };
        grid.appendChild(card);
      });
    }

    loadShops();
  </script>
</body>
</html>
