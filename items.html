<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Items | Chat Point</title>

  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>

  <style>
    :root {
      --bg: #0f0f1a;
      --card: rgba(20, 25, 45, 0.7);
      --text: #e0e7ff;
      --accent: #ff6b35;
      --glow: rgba(255, 107, 53, 0.3);
      --radius: 18px;
      --cart-height: 78px;
    }
    * { margin:0; padding:0; box-sizing:border-box; }
    body {
      font-family: 'Outfit', sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
      padding-bottom: var(--cart-height);
      overflow-x: hidden;
    }
    body::before {
      content: '';
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background: 
        radial-gradient(circle at 20% 80%, rgba(255, 107, 53, 0.12), transparent 50%),
        radial-gradient(circle at 80% 20%, rgba(100, 200, 255, 0.08), transparent 50%);
      z-index: -1;
    }

    header {
      padding: 16px 20px;
      background: rgba(15, 20, 40, 0.85);
      backdrop-filter: blur(12px);
      border-bottom: 1px solid rgba(255, 107, 53, 0.2);
      display: flex;
      justify-content: space-between;
      align-items: center;
      position: sticky;
      top: 0;
      z-index: 100;
    }
    .brand { font-weight: 800; font-size: 26px; }
    .brand .chat { 
      background: linear-gradient(90deg, #ff6b35, #ff8a5b);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    .shop-name {
      font-size: 18px; font-weight: 700; color: var(--accent);
    }
    .back-btn {
      font-size: 22px; cursor: pointer; padding: 8px;
      background: rgba(255, 107, 53, 0.15);
      border-radius: 50%; transition: 0.3s;
    }
    .back-btn:hover { background: var(--accent); color: #000; }

    main { padding: 20px; max-width: 1000px; margin: 0 auto; }

    .login-banner {
      background: rgba(255, 107, 53, 0.15);
      border: 1px solid rgba(255, 107, 53, 0.4);
      border-radius: 14px;
      padding: 12px 16px;
      margin-bottom: 20px;
      text-align: center;
      font-weight: 600;
      color: #ff8a5b;
    }
    .login-banner a {
      color: #ff6b35;
      text-decoration: underline;
    }

    .items-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 20px;
    }
    .item-card {
      background: var(--card);
      border-radius: var(--radius);
      overflow: hidden;
      border: 1px solid rgba(255, 107, 53, 0.2);
      backdrop-filter: blur(10px);
      transition: 0.4s;
    }
    .item-card:hover {
      transform: translateY(-8px);
      box-shadow: 0 15px 30px rgba(0,0,0,0.4), 0 0 25px var(--glow);
    }
    .item-img {
      width: 100%; height: 180px; object-fit: cover;
      background: #1a1a2e;
    }
    .item-info {
      padding: 16px;
    }
    .item-name {
      font-weight: 700; font-size: 18px; color: #fff;
    }
    .item-desc {
      font-size: 13px; color: #a8b8ff; margin: 6px 0 10px;
    }
    .item-price {
      font-weight: 900; font-size: 19px; color: var(--accent);
    }
    .quantity {
      display: flex; align-items: center; gap: 12px; margin-top: 12px;
      background: rgba(255, 107, 53, 0.1); padding: 8px 12px;
      border-radius: 50px; justify-content: center;
    }
    .qbtn {
      width: 36px; height: 36px; border-radius: 50%;
      background: rgba(255, 107, 53, 0.2); color: #fff;
      border: none; font-weight: bold; cursor: pointer;
      transition: 0.3s;
    }
    .qbtn:hover {
      background: var(--accent); color: #000;
    }
    .qty { min-width: 30px; text-align: center; font-weight: 900; color: #34d399; }

    .cart-bar {
      position: fixed; left: 12px; right: 12px; bottom: 12px;
      height: var(--cart-height); background: rgba(15, 20, 40, 0.98);
      border-radius: 18px; padding: 0 24px;
      display: none; align-items: center; justify-content: space-between;
      border: 1px solid rgba(255, 107, 53, 0.3);
      backdrop-filter: blur(20px); z-index: 100;
    }
    .cart-info .main { font-size: 18px; font-weight: 900; }
    .checkout-btn {
      background: linear-gradient(90deg, #34d399, #10b981);
      color: #000; font-weight: 900; padding: 12px 24px;
      border-radius: 14px; border: none; cursor: pointer;
      transition: 0.3s;
    }
    .checkout-btn:hover {
      transform: scale(1.05); box-shadow: 0 0 20px rgba(52, 211, 153, 0.5);
    }

    @media (max-width: 768px) {
      .items-grid { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>

  <header>
    <div class="back-btn" onclick="history.back()">
      <i class="fas fa-arrow-left"></i>
    </div>
    <div class="brand"><span class="chat">Chat</span>Point</div>
    <div class="shop-name" id="shopName">Loading...</div>
  </header>

  <main>
    <div id="loginBanner" class="login-banner" style="display:none;">
      Please <a href="login.html">login</a> to add items to cart.
    </div>
    <div class="items-grid" id="itemsGrid"></div>
  </main>

  <div class="cart-bar" id="cartBar" onclick="openCartPage()">
    <div class="cart-info">
      <div class="main" id="cartText">0 items · ₹0</div>
      <div style="font-size:13px; color:#888; margin-top:4px;">Tap to view cart</div>
    </div>
    <button class="checkout-btn" onclick="event.stopPropagation(); openCartPage()">
      Checkout
    </button>
  </div>

  <script>
    // ============== USER LOGIN CHECK ==============
    const USER_KEY = "chatpoint_user";
    const user = JSON.parse(localStorage.getItem(USER_KEY) || "null");
    const isLoggedIn = user && user._id;

    if (!isLoggedIn) {
      document.getElementById("loginBanner").style.display = "block";
    }

    // ============== SHOP DATA (FIXED TYPO: "Idli ") ==============
    const shopData = {
      "7th Wonder (Cake)": [
        { name: "Chocolate Truffle Cake", price: 350 },
        { name: "Red Velvet Cake", price: 380 },
        { name: "Black Forest", price: 320 }
      ],
      "Sangambar Udpi-Hotel": [
        { name: "Masala Dosa", price: 75 },
        { name: "Plain Dosa", price: 60 },
        { name: "Idli", price: 55 },  // ← Fixed space
        { name: "Vada", price: 45 }
      ],
      "Nandini Grand Hotels": [
        { name: "Shira", price: 35 },
        { name: "Set D20 Dosa", price: 65 },
        { name: "Poori", price: 70 },
        { name: "Full Meals", price: 95 },
        { name: "Onion Dosa", price: 75 },
        { name: "Utappa", price: 75 },
        { name: "Mysore Bonda", price: 75 },
        { name: "Mangalore Buns", price: 75 },
        { name: "Paneer Dosa", price: 80 },
        { name: "Cheese Dosa", price: 75 },
        { name: "Chou Chou Bath", price: 70 }
      ],
      "Pizza Point": [
        { name: "Margherita", price: 99 },
        { name: "Pepperoni", price: 149 }
      ],
      "Fly Pizza": [
        { name: "Veggie Delight", price: 129 },
        { name: "Margherita", price: 99 }
      ],
      "Mister Chef": [
        { name: "Classic Burger", price: 120 },
        { name: "French Fries", price: 99 }
      ],
      "Bekary": [
        { name: "Veg Sandwich", price: 80 }
      ],
      "Dolphin": [
        { name: "Chicken Tandoori", price: 280 }
      ]
    };

    // ============== GET SHOP FROM URL ==============
    const urlParams = new URLSearchParams(window.location.search);
    const shopName = decodeURIComponent(urlParams.get("shop") || "");
    const shopItems = shopData[shopName] || [];

    // ============== DOM ELEMENTS ==============
    const shopNameEl = document.getElementById("shopName");
    const itemsGrid = document.getElementById("itemsGrid");
    const cartBar = document.getElementById("cartBar");
    const cartText = document.getElementById("cartText");

    // ============== CART LOGIC ==============
    let cart = JSON.parse(localStorage.getItem("chatpoint_cart")) || {};

    function saveCart() {
      localStorage.setItem("chatpoint_cart", JSON.stringify(cart));
      updateCartBar();
    }

    function updateCartBar() {
      let totalItems = 0, totalPrice = 0;
      for (const shop in cart) {
        for (const item in cart[shop]) {
          totalItems += cart[shop][item].qty;
          totalPrice += cart[shop][item].qty * cart[shop][item].price;
        }
      }
      cartText.textContent = `${totalItems} items · ₹${totalPrice}`;
      cartBar.style.display = totalItems > 0 ? "flex" : "none";
    }

    function changeQty(shop, itemName, price, delta) {
      if (!isLoggedIn) { alert("Please login to add items to cart."); return; }
      if (!cart[shop]) cart[shop] = {};
      if (!cart[shop][itemName]) cart[shop][itemName] = { qty: 0, price };
      cart[shop][itemName].qty = Math.max(0, cart[shop][itemName].qty + delta);
      if (cart[shop][itemName].qty === 0) delete cart[shop][itemName];
      if (Object.keys(cart[shop]).length === 0) delete cart[shop];
      saveCart();
      renderItems();
    }

    function openCartPage() {
      if (!isLoggedIn) { alert("Please login to view cart."); window.location.href = "login.html"; return; }
      window.location.href = "cart.html";  // ← Fixed: was "/cart.html"
    }

    // ============== IMAGE PATH + FALLBACK ==============
    function getImagePath(itemName) {
      const slug = itemName
        .toLowerCase()
        .replace(/[^a-z0-9]+/g, '-')
        .replace(/^-+|-+$/g, '');
      return `images/${slug}.jpg`;
    }

    // ============== RENDER ITEMS ==============
    function renderItems() {
      itemsGrid.innerHTML = "";
      if (shopItems.length === 0) {
        itemsGrid.innerHTML = `<div style="grid-column:1/-1;text-align:center;color:#888;padding:40px;font-size:18px;">No items found for this shop.</div>`;
        return;
      }

      shopItems.forEach(item => {
        const qty = cart[shopName]?.[item.name]?.qty || 0;
        const imgSrc = getImagePath(item.name);

        const card = document.createElement("div");
        card.className = "item-card";

        const qtyHTML = isLoggedIn
          ? `
            <div class="quantity">
              <button class="qbtn" onclick="changeQty('${shopName}', '${item.name}', ${item.price}, -1)">−</button>
              <div class="qty">${qty}</div>
              <button class="qbtn" onclick="changeQty('${shopName}', '${item.name}', ${item.price}, 1)">+</button>
            </div>
          `
          : `<div style="margin-top:12px; color:#ff8a5b; font-size:13px; text-align:center;">Login to add</div>`;

        card.innerHTML = `
          <img class="item-img" src="${imgSrc}" alt="${item.name}"
               onerror="this.src='https://via.placeholder.com/300x180/1a1a2e/ffffff?text=${encodeURIComponent(item.name)}'" loading="lazy">
          <div class="item-info">
            <div class="item-name">${item.name}</div>
            <div class="item-desc">Fresh • Chef's Special</div>
            <div class="item-price">₹${item.price}</div>
            ${qtyHTML}
          </div>
        `;
        itemsGrid.appendChild(card);
      });
    }

    // ============== INIT ==============
    if (shopName && shopData[shopName]) {
      shopNameEl.textContent = shopName;
      renderItems();
      updateCartBar();
    } else {
      shopNameEl.textContent = "Shop Not Found";
      itemsGrid.innerHTML = `<div style="grid-column:1/-1;text-align:center;color:#f55;padding:40px;">Invalid shop. <a href="index.html" style="color:var(--accent)">Go back</a></div>`;
    }
  </script>
</body>
</html>