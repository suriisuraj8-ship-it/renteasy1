<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Add Shop | RentEasy</title>
  <style>
    body {
      font-family: "Poppins", sans-serif;
      background: #0b0b0b;
      color: #fff;
      margin: 0;
      padding: 0;
      text-align: center;
    }

    h2 {
      margin-top: 20px;
      color: #ffcc00;
    }

    form {
      background: #1a1a1a;
      padding: 20px;
      margin: 20px auto;
      border-radius: 10px;
      width: 90%;
      max-width: 400px;
      box-shadow: 0 0 15px rgba(255, 204, 0, 0.3);
    }

    input, textarea, select {
      width: 100%;
      padding: 10px;
      margin: 8px 0;
      border: none;
      border-radius: 5px;
      outline: none;
    }

    input[type="file"] {
      background: #333;
      color: #ccc;
    }

    button {
      background: #ffcc00;
      border: none;
      color: #000;
      font-weight: bold;
      padding: 12px;
      border-radius: 5px;
      cursor: pointer;
      width: 100%;
      transition: 0.3s;
    }

    button:hover {
      background: #e6b800;
    }

    #message {
      margin-top: 10px;
      color: #ff6666;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <h2>üõçÔ∏è Add Your Shop</h2>

  <form id="shopForm" enctype="multipart/form-data">
    <input type="text" id="ownerName" placeholder="Owner Name" required />
    <input type="text" id="shopName" placeholder="Shop Name" required />
    <input type="text" id="location" placeholder="Location" required />
    <input type="number" id="rent" placeholder="Monthly Rent" required />
    <textarea id="description" placeholder="Description" rows="3" required></textarea>
    <label style="display:block;margin-top:10px;">Upload Images:</label>
    <input type="file" id="images" multiple required />
    <button type="button" onclick="uploadShop()">Submit Shop</button>
    <div id="message"></div>
  </form>

  <script>
    async function uploadShop() {
      const messageBox = document.getElementById("message");
      messageBox.textContent = "Uploading... ‚è≥";

      const formData = new FormData();
      formData.append("ownerName", document.getElementById("ownerName").value);
      formData.append("shopName", document.getElementById("shopName").value);
      formData.append("location", document.getElementById("location").value);
      formData.append("rent", document.getElementById("rent").value);
      formData.append("description", document.getElementById("description").value);

      const images = document.getElementById("images").files;
      for (let i = 0; i < images.length; i++) {
        formData.append("images", images[i]);
      }

      try {
        // üëá Change this URL when testing locally vs deployed
        const response = await fetch("https://renteasy1.onrender.com/api/upload", {
          method: "POST",
          body: formData,
        });

        // ‚úÖ Ensure response is JSON
        const text = await response.text();
        let data;
        try {
          data = JSON.parse(text);
        } catch (e) {
          throw new Error("Invalid JSON response from server: " + text.slice(0, 100));
        }

        if (data.success) {
          messageBox.style.color = "lightgreen";
          messageBox.textContent = "‚úÖ Shop uploaded successfully!";
          document.getElementById("shopForm").reset();
        } else {
          messageBox.style.color = "#ff6666";
          messageBox.textContent = "‚ùå Upload failed: " + (data.message || "Unknown error");
        }
      } catch (error) {
        console.error("üî• Fetch Error:", error);
        messageBox.style.color = "#ff6666";
        messageBox.textContent = "‚ö†Ô∏è Error: " + error.message;
      }
    }
  </script>
</body>
</html>
